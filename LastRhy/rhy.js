//==================================================
// class
//==================================================

class TestClass {
    constructor() {
        (() => {
            this.test2();
        })();
    }

    test1() {
        let can = Myfunc.createCanvas(100,100,false,0,0,10);
        can.style.backgroundColor = "red";
        document.body.appendChild(can);

        let div = Myfunc.createDiv(50,50,11);
        div.style.transform = `rotate(30deg)`;
        let can2 = Myfunc.createCanvas(90,5,false,0,0,0);
        can2.style.backgroundColor = "blue";
        div.appendChildCenter(can2);
        document.body.appendChild(div);
    }

    test2() {
        ctx = document.getElementById("canvasB").getContext("2d");
        ctx.lineWidth = 2;
        ctx.strokeStyle = Myfunc.getRainbowColor(0,0,0,360);
        ctx.strokeRect(0,0,700,360);
        ctx.strokeRect(30,0,640,360);
        ctx.strokeRect(30,40,640,120);
        ctx.beginPath();
        ctx.arc(130,260,100,0,Math.PI*2,true);
        ctx.closePath();
        ctx.stroke();
        ctx.beginPath();
        ctx.arc(570,260,100,0,Math.PI*2,true);
        ctx.closePath();  
        ctx.stroke();

    }

}

class Myfunction {
    createDiv(x,y,z) {
        let div = document.createElement("div");
        div.style.position = "absolute";
        div.style.left = `${x}px`;
        div.style.top = `${y}px`;
        div.style.zIndex = z;
        div.width = 0;
        div.height = 0;
        return div;
    }

    createCanvas(w,h,isCenter,left,top,zIndex) {
        let canvas = document.createElement("canvas");
        canvas.width = w;
        canvas.height = h;
        canvas.style.position = "absolute";
        canvas.style.left = left + "px";
        canvas.style.top = top + "px";
        canvas.style.zIndex = zIndex;
        let ctx = canvas.getContext("2d");
        if(isCenter) {ctx.translate(w/2,h/2)};
        return canvas;
    }

    createEllipseRing(x,y,r,d,h,r1,g1,b1,r2,g2,b2) {
        let grad;
        grad = ctx.createLinearGradient(-200,-200,-200,200);
        grad.addColorStop(0.0,`rgb(${r1},${g1},${b1})`);
        grad.addColorStop(1.0,`rgb(${r2},${g2},${b2})`);
        ctx.fillStyle = grad;
    
        ctx.beginPath();
        ctx.moveTo(x+r,y-h);
        ctx.arc(x,y,r,0,Math.PI,false);
        ctx.arc(x,y-h,r,Math.PI,0,false);
        ctx.moveTo(x+r+d,y-h);
        ctx.arc(x,y-h,r+d,0,Math.PI,true);
        ctx.arc(x,y,r+d,Math.PI,0,true);
        ctx.fill();
    
    }

    translateTosheet(s1,s2,s3,bpm) {
        class tmpSheet {
            constructor(t1,t2,c) {
                this.type1 = t1;
                this.type2 = t2;
                this.count = c;
            }
        }
    
        let r = [];
        let saved = ["0","0"];
    
        let tmp1 = [];
        let tmp2 = [];
        let tmp3 = [];
    
        for(let i = 0; i < s1.length; i ++) {tmp1.push(s1.charAt(i)); tmp2.push(s2.charAt(i)); tmp3.push(s3.charAt(i))};
    
        for(let i = 0; i < s1.length; i ++) {
            if(tmp1[i] !== "0" && tmp1[i] !== "9") {saved[0] = tmp1[i]};
            if(tmp2[i] !== "0" && tmp2[i] !== "9") {saved[1] = tmp2[i]};
            if(tmp1[i] === "9") {tmp1[i] = "b" + saved[0]};
            if(tmp2[i] === "9") {tmp2[i] = "b" + saved[1]};
        }
    
        let saved2 = [false,false];
    
        for(let i = tmp1.length -1; i >= 0; i --) {
            if(tmp1[i].charAt(0) === "b") {saved2[0] = true};
            if(tmp2[i].charAt(0) === "b") {saved2[1] = true};
            if(saved2[0] && !isNaN(tmp1[i]) && tmp1[i] !== "0") {tmp1[i] = "a" + tmp1[i]; saved2[0] = false};
            if(saved2[1] && !isNaN(tmp2[i]) && tmp2[i] !== "0") {tmp2[i] = "a" + tmp2[i]; saved2[1] = false};
        }
    
        for(let i = 0; i < tmp1.length; i ++) {
            if(tmp1[i].length === 1 && tmp1[i].charAt(0) === "0") {tmp1[i] = tmp1[i] + "0"};
            if(tmp2[i].length === 1 && tmp2[i].charAt(0) === "0") {tmp2[i] = tmp2[i] + "0"};  
            if(tmp1[i].length === 1) {tmp1[i] = tmp1[i] + "x"};
            if(tmp2[i].length === 1) {tmp2[i] = tmp2[i] + "x"};
        }
    
        for(let i = 0; i < tmp1.length; i ++) {
            if(tmp1[i].charAt(0) === "a") {tmp1[i] = tmp1[i].charAt(1) + "x" + "h"};
            if(tmp2[i].charAt(0) === "a") {tmp2[i] = tmp2[i].charAt(1) + "x" + "h"};
            if(tmp1[i].charAt(0) === "b") {tmp1[i] = tmp1[i].charAt(1) + "y" + "e"};
            if(tmp2[i].charAt(0) === "b") {tmp2[i] = tmp2[i].charAt(1) + "y" + "e"};
        }
    
        for(let i = 0; i < tmp1.length; i ++) {
            if(tmp1[i].length === 2) {tmp1[i] = tmp1[i] + "0"};
            if(tmp2[i].length === 2) {tmp2[i] = tmp2[i] + "0"};  
        }
    
        for(let i = 0; i < tmp1.length; i ++) {
            if(tmp3[i] !== "0") {tmp1[i] = tmp1[i] + tmp3[i]};
        }
    
        for(let i = 0; i < tmp1.length; i ++) {
            if(tmp1[i].length === 3) {tmp1[i] = tmp1[i] + "0"};
            if(tmp2[i].length === 3) {tmp2[i] = tmp2[i] + "0"};  
        }

        for(let i = 0; i < tmp1.length; i ++) {
            tmp1[i] = tmp1[i] + tmp1[i].charAt(0);
            tmp2[i] = tmp2[i] + tmp2[i].charAt(0);
        }
    
        for(let i = 0; i < tmp1.length; i ++) {
            if(tmp1[i] === "00000" && tmp2[i] === "00000") {continue};
            let c = Math.round(i *250/bpm);
            r.push(new tmpSheet(tmp1[i],tmp2[i],c));
        }

    
        return r;
    }

    getRainbowColor(x1,y1,x2,y2) {
        let grad;
        grad = ctx.createLinearGradient(x1,y1,x2,y2);
        grad.addColorStop(0.0,`rgb(255,0,0)`);
        grad.addColorStop(0.2,`rgb(255,127,0)`);
        grad.addColorStop(0.4,`rgb(255,255,0)`);
        grad.addColorStop(0.6,`rgb(0,255,0)`);
        grad.addColorStop(0.8,`rgb(0,0,255)`);
        grad.addColorStop(1.0,`rgb(143,0,255)`);
        return grad;
    }

    playsound(number,delay) {
        let link = [0,"sounds/tan.mp3","sounds/don.wav"];
        let tmp = document.createElement("audio");
        tmp.src = link[number];
        tmp.currentTime = delay;
        tmp.play();

    }
}

class Myprototype {
    constructor() {
        (() => {
            Element.prototype.appendChildCenter = function(elm) {
                this.appendChild(elm);
                let w = elm.width;
                let h = elm.height;
                elm.style.left = `${-w/2}px`;
                elm.style.top = `${-h/2}px`;
            }
        })();
    }

}

class Administrator {
    constructor() {
        [this.COOL,this.FINE,this.SAFE,this.SAD,this.WORST,this.COMBO] = [0,0,0,0,0,0];

        this.verdict = (e) => {
            let XL,XR,R, x,y,z,last,t,judgeRange,judgeResult;  

            e.preventDefault(); //PC側の応答を停止
            XL = [130,260]; //左側の中心軸
            XR = [570,260]; //右側の中心軸
            R = 200; //半径  
            judgeRange = [[-10,-5],[-5,-3],[-3,-1],[-1,1],[1,3] ,[3,5] ,[5,10]];
            judgeResult = ["SAD"  ,"SAFE" ,"FINE" ,"COOL","FINE","SAFE","SAD"];
            
            //===タッチ座標取得===//
            if(e.touches[0] === undefined && e.touches[1] === undefined) {
                    //R
                    [x,y,z] = [parseInt(e.changedTouches[0].pageX),parseInt(e.changedTouches[0].pageY),"y"];
            } else if(e.touches[0] !== undefined && e.touches[1] === undefined) {
                if(e.changedTouches[0].pageX === e.touches[0].pageX) {
                    //P
                    [x,y,z] = [parseInt(e.touches[0].pageX),parseInt(e.touches[0].pageY),"x"];
                } else {
                    //P & R
                    [x,y,z] = [parseInt(e.changedTouches[0].pageX),parseInt(e.changedTouches[0].pageY),"y"];
                }
            } else  {
                if(e.changedTouches[0].pageX === e.touches[1].pageX) {
                    //P && P
                    [x,y,z] = [parseInt(e.touches[1].pageX),parseInt(e.touches[1].pageY),"x"];
                } else {
                    //P && P
                    [x,y,z] = [parseInt(e.touches[0].pageX),parseInt(e.touches[0].pageY),"x"];
                }
            }
            
            //===ABXYに変換===//
            x = (Math.abs(x-XL[0] < Math.abs(x-XR[0])))? x = x - XL[0]:x = x - XR[0];
            y = y - XL[1];
            if(x**2 + y**2 <= R**2) {
                if(y <= x && y >= -x ){last = "2" + z};
                if(y >= x && y >= -x ){last = "3" + z};
                if(y >= x && y <= -x ){last = "5" + z};
                if(y <= x && y <= -x ){last = "7" + z};
            }
            
            //===判定処理===//
            if(sheet[j2].count > i2 + 8) { //早すぎ
            }  else { //ok
                if(last === sheet[j2].type1.slice(0,2)) {
                    sheet[j2].type1 = "00" + sheet[j2].type1.slice(2,5);
                } else if(last === sheet[j2].type2.slice(0,2)) {
                    sheet[j2].type2 = "00" + sheet[j2].type2.slice(2,5);
                }
            }

            //どっちもクリアで次のノーツへ
            if(sheet[j2].type1.slice(0,2) === "00" && sheet[j2].type2.slice(0,2) === "00") {
                t = Math.abs(sheet[j2].count - i2);
                for(let i = 0; ;i++) {
                    if(judgeRange[i][0] <= t && t <= judgeRange[i][1]) {
                        this.display(judgeResult[i]);
                        j2 ++;
                        break;
                    }
                }
            }

        }

        (() => {this.init()})();
    }

    init() {
        window.ontouchstart = this.verdict;
        window.ontouchend = this.verdict;
    }


    display(res) {
        let t;

        if(sheet[j2].type1.charAt(2) === "h" || sheet[j2].type2.charAt(2) === "h"){Judge.fill()};
        if(sheet[j2].type1.charAt(2) === "e" || sheet[j2].type2.charAt(2) === "e"){Judge.clear()};

        switch(res) {
            case "COOL": this.COOL ++; this.COMBO++; t = 0; break;
            case "FINE": this.FINE ++; this.COMBO++;  t = 1;break;
            case "SAFE": this.SAFE ++; this.COMBO = 0; t = 2;break;
            case "SAD": this.SAD ++; this.COMBO = 0;  t = 3;break;
            case "WORST": this.WORST ++; this.COMBO = 0;  t = 4;break;
        }

        document.getElementById("result1").textContent = `COOL:${this.COOL} FINE:${this.FINE} SAFE:${this.SAFE} SAD:${this.SAD} WORST:${this.WORST} `

        let text1,text2;
        Judge.canvas2.style.top = "-50px";
        ctx = Judge.canvas2.getContext("2d");
        ctx.font = "20px Times New Roman";
        ctx.clearRect(-100,-60,200,120);
        ctx.strokeStyle = ["gold","silver","lightgreen","blue","purple"][t];
        text1 = ["COOL","FINE","SAFE","SAD","WORST"][t];
        text2 = (this.COMBO === 0)? "":this.COMBO;
        ctx.strokeText(`${text1} ${text2}`,0,0);

        noteFolder[0].remove();
        noteFolder.shift();
    }


}

class JudgeNote {
    constructor() {
        this.div = Myfunc.createDiv(130,100,200);
        this.canvas1 = Myfunc.createCanvas(60,120,true,0,0,0);
        this.canvas2 = Myfunc.createCanvas(200,60,true,0,0,0);
        (() => {this.init()})();
    }

    init() {
        this.div.appendChildCenter(this.canvas1);
        ctx = this.canvas1.getContext("2d");
        
        this.div.appendChildCenter(this.canvas2);
        ctx.strokeStyle = "grey";
        ctx.strokeRect(0,-60,1,120);

        scon.appendChild(this.div);

    }

    tick() {
        //判定結果アニメーション
        if(this.canvas2.style.top !== "-30px") {
            let top = this.canvas2.style.top;
            this.canvas2.style.top = `${parseInt(top.slice(0,top.length-2)) + 5}px`;
        }

    }

    fill() {
        let t,image,imageTable; 
        console.log("!");

        imageTable = ["","","A","B","","Y","","X"];
        t = (sheet[j2].type1.charAt(2) === "h")? parseInt(sheet[j2].type1.charAt(4)):0;
        ctx = this.canvas1.getContext("2d");
        image = document.getElementById(`button${imageTable[t]}`);
        if(image !== null){
            Myfunc.createEllipseRing(0,30,25,5,0,0,0,0,0,255,255,255);
            ctx.drawImage(image,-25,5,50,50);
        }

        imageTable = ["","","R","D","","L","","U"];
        t = (sheet[j2].type2.charAt(2) === "h")? parseInt(sheet[j2].type2.charAt(4)):0;
        image = document.getElementById(`button${imageTable[t]}`);
        if(image !== null){
            Myfunc.createEllipseRing(0,-30,25,5,0,0,0,0,0,255,255,255);
            ctx.drawImage(image,-25,-55,50,50);
        }
    }

    clear() {
        ctx = this.canvas1.getContext("2d");
        ctx.strokeStyle = "grey";
        if(sheet[j2].type1.charAt(2) === "e"){ctx.clearRect(-30,0,60,60),ctx.strokeRect(0,-60,1,120)};
        if(sheet[j2].type2.charAt(2) === "e"){ctx.clearRect(-30,-60,60,60),ctx.strokeRect(0,-60,1,120)};
        
    }


}

class Note {
    constructor(t1,t2) {
        this.t1 = t1;
        this.t2 = t2;
        this.div = Myfunc.createDiv(630,100,100);

        this.div1 = Myfunc.createDiv(0,30,0);
        this.canvas1 = Myfunc.createCanvas(60,60,false,0,0,0);
        this.div2 = Myfunc.createDiv(0,-30,0);
        this.canvas2 = Myfunc.createCanvas(60,60,false,0,0,0);

        (() => {this.init()})();
    }

    init() {
        let imageTable,image;

        this.div1.appendChildCenter(this.canvas1);
        this.div2.appendChildCenter(this.canvas2);  
        this.div.appendChild(this.div1);
        this.div.appendChild(this.div2);
        scon.appendChild(this.div);
        
        ctx = this.canvas1.getContext("2d");
        imageTable = ["","","A","B","","Y","","X"];
        image = document.getElementById(`button${imageTable[parseInt(this.t1.charAt(0))]}`);
        if(["h","e"].includes(this.t1.charAt(2))) {
            Myfunc.createEllipseRing(30,30,25,5,0,0,0,0,0,255,255,255);
        }

        if(["p"].includes(this.t1.charAt(3))) {
            ctx.fillStyle = Myfunc.getRainbowColor(0,4,0,56);
            ctx.beginPath();
            ctx.arc(30,30,26,0,Math.PI*2);
            ctx.closePath();
            ctx.fill();

        }
        if(image !== null) {ctx.drawImage(image,5,5,50,50)};

        ctx = this.canvas2.getContext("2d");
        imageTable = ["","","R","D","","L","","U"];
        image = document.getElementById(`button${imageTable[parseInt(this.t2.charAt(0))]}`);
        if(["h","e"].includes(this.t2.charAt(2))) {
            Myfunc.createEllipseRing(30,30,25,5,0,0,0,0,0,255,255,255);
        }
        if(image !== null) {ctx.drawImage(image,5,5,50,50)};

    }

    tick() {
        let x = this.div.style.left;
        this.div.style.left = `${parseInt(x.slice(0,x.length-2))-5}px`;
    }

    remove() {
        this.div.remove();
    }
}
//==================================================
// global variable
//==================================================

let scon = document.getElementById("container");
let ctx = "";
let don = document.getElementById("don");
let tan = document.getElementById("tan");

let [i1,j1,i2,j2] = [0,0,-100,0];

//let bpm = 92;
//let delay = 980;
//let sheet1 = "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000200000200200000000000000000000200200000000000000000000000000900000000000000000000000000000200200200200000200000000300000300000300000300000000000000000000000900000000000000000000000000000500000500000500500000000500000500000500500000000000000000000000000000000000000000000000000900000700700700700000700000000700000700000700000700000000000000000000000000000000000000000700700200000700700000200200700200200000700000000500500700000500500000700700500700700000700000000000000000000500500300000500500000000300000300000300000300000000000000000000900000000000000000000200200300000200200000200200300200200000200000000300300200000200000200000200200000000700000700700000000000000200000200000200000000000000000000000900000000000700000700000700000700000500500700000500000700000000000000000000000000000000000000000000000000000000000000000000000000000000000900000000000300000300000200000200000000000000000900000000000500000500000700000700000500000500500000700000000500000500000500000500000700000700700000000200000200000000000000000000000000000000000900000500500500000700700000700700000000000200000200200000000700000700000700000700000000000000000000000000000200000200000200000200200000000000000000000000000500000000000500000000000300000300200000000000000000000000000000000000000000000900200000000000000500000000000300000000000300000300200000000200000200000000000900000000000700000000000000000000000900000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//let sheet2 = "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000200000700000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000500500000500500500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700000000000000000900000000000500000500000500000000000000000000000000000000000000000000000000000700000000000900000000000200000000000900000000000700000000000000000000000000000000000900000000000300000300000200000200000000000000000900000000000000000000000000000000000500000500500000700000000000000000000000000000000700000700700000000000000000000000000000000300000300000000000000000000000000000000000000000000000000000000000900300000000000000000000000000000000500000500500000500000000000000000000000000000000300000300300000000000000000000000000000000000000000000000000000000000000700000000000500000000000700000700700000000000000000000000000000000000000000000000000000000000000000000000000200000000000700000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
//let sheet3 = "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000p00000p00000000000000000000000000000000000000000000000000000000000L00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000p00000000000000000000000000000p00000p00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000u00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000L00000000000000000000000000000000000000000000000000000000u00000000000000000000000000000000000000000000000L00000000000000000000000000000000000000000000000L00000000000000000000000000000000000000000000u00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000L00000000000000000000000000000000000000000000000L00000000000000000000000000000000000000000L00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000u00000000000000000000d00000000000000000000000000000u00000000000d00000000000000000000000000000000000000000000000u00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

let x1 = "0"
let bpm = 158;
let delay = 1300;
let sheet1 = "200000200000200000200000000000900000200000200000000000200000200000200000000000200000200000200000200000200000200000200000000000200000200000200000000000200000200000200000000000200000200000200000000000200000200000200000000000200000200000200000200000000000200000000000200000000000300000300000000000300000300000300000300000300000300000500000500000000000500000000000500000000000700000700000000000700000700000700000700000000000000000200000200000000000300000000000300000000000500000500000000000700000700000700000000000000000200000200000000000900000200000200000500000500000200000200000000000900000200000000000200000200200200000200000200000000000200000000000200000000000200000200000000000200200200000200000200000200000200000000000200000200200200000200000000000200000200000200000000000200000200000200000000000200000200000000000200000000000200000200000200000200000200000200000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002";
let sheet2 = "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000300000000000000000500000000000700000000000700000000000000000700000700000000000000000000000000000000000000000000000000000000000900000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000700000000000700000000000500000500000500000000000900000500000000000200000000000500000500000300000300000500000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002";
let sheet3 = "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";


let sheet = [];
let noteFolder = [];

let Admin = new Administrator();
let Myfunc = new Myfunction();
let Mypro = new Myprototype();
let Test = new TestClass();
let Judge = new JudgeNote();


//==================================================
// function
//==================================================

function init() {
    onkeydown = mykeydown;

    //コンパイル
    sheet = Myfunc.translateTosheet(sheet1,sheet2,sheet3,bpm);
}

function tick() {
    Judge.tick();

    //描画処理
    noteFolder.forEach(function(e) {e.tick()});

    //ノーツ設置
    if(sheet[j1].count === i1) {
        noteFolder.push(new Note(sheet[j1].type1,sheet[j1].type2));
        j1 ++;
    }

    //超過ノーツ削除
    if(sheet[j2].count + 8 < i2) {
        Admin.display("WORST");
        j2 ++;
    }

    i1 ++;
    i2 ++;
}

function start() {
    let music = document.getElementById("music");
    music.play();
    setTimeout(function(){music.currentTime = 0;},delay);
    setInterval(tick,20);
}


function mykeydown(e) {
    switch(e.key) {
        case "q":
            start()
            break;
    } 
}

function test() {
    window.ontouchstart = function(e) {
        document.getElementById("result1").textContent = e.touches[0].pageX + "," + e.touches[0].pageY;
    }
    document.body.requestFullscreen();
}
let x = "1234567";
